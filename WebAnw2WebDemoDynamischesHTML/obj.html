<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>WebAnwendungen 2 Web Client</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css">

    </head>

    <body>

        <h2>Beispiel für dynamisches HTML 2 - Objektorientiert</h2>

        <p>
            Achten Sie darauf, dass das Backend auf ihrem Rechner läuft und benutzbar ist!
            <br><br>
            Bei diesem Beispiel werden alle Mehrwertsteuer - Einträge geladen, Objekte von HTML Elementen erzeugt, mit Daten versorgt und ausgegeben.
            <br><br>
            Diese Variante ist etwas komplizierter zu verstehen, aber eigentlich flexibler und sinnvoller. Oder Sie verwenden die <a href="index.html">Oldschool - Methode</a>. Sehen Sie hierzu die andere Datei.
            <br><br>
            Der AJAX Aufruf und das Zusammensetzen und Anzeigen wird am Ende des Seitenaufbaus ausgeführt, ohne weiter Interaktion durch den User.
        </p>

        <br>
        <hr>
        <br><br>

        <!-- KEIN ZIEL für dynamsichen Inhalt. Dieser wird einfach immer weiter angehängt -->

        <script>      
        
        $(document).ready(function() {
            console.log("Document ready, loading data from Service");

            $.ajax({
                url: "http://localhost:7000/shop",
                method: "get",
				dataType: "json"
            }).done(function (response) {
                console.log("Data loaded successfully");
                console.log(response);

                /* die Idee bei diesem Prinzip ist, dass HTML Elemente als Objekte angesehen werden
                    welche mit existierenden Methoden mit Daten und Attributen usw. versorgt werden können.
                */
                    
                // HTML Element anlegen

                var div = $("<div>");

                // object mit weiterem Inhalt und Code vervollständigen
                div.append("Folgende Daten wurden geladen:<br><br>");
                
                    // unterobjekte erstellen
                    var table = $("<table>");
                    var tr = null;
                    var td = null;
                    table.prop("style", "width:80%;border:1px solid black");
                    table.append("<tr><th>SortID</th><th>KatID</th><th>Steuersatz</th><th>Bezeichnung</th><th>Beschreibung</th><th>Preis</th><th>Bildpfad</th></tr>");
                        
                    for (i = 0; i < response.daten.length; i++) {
                        // Objekt aus array holen
                        var obj = response.daten[i];

                        // zeile erstellen
                        tr = $("<tr>");

                            // zellen erstellen, mit Daten bestücken und der Zeile hinzufügen
                            td = $("<td>");
                            td.text(obj.SortID);
                            tr.append(td);

                            td = $("<td>");
                            td.text(obj.KatID);
                            tr.append(td);

                            td = $("<td>");
                            td.text(obj.MwStID);
                            tr.append(td);

                            td = $("<td>");
                            td.text(obj.Bezeichnung);
                            tr.append(td);

                            td = $("<td>");
                            td.text(obj.Beschreibung);
                            tr.append(td);

                            td = $("<td>");
                            td.text(obj.Preis);
                            tr.append(td);

                            td = $("<td>");
                            td.text(obj.BildPfad);
                            tr.append(td);

                        // zeile der Tabelle hinzufügen
                        table.append(tr);
                    }

                // tabelle dem div hinzufügen
                div.append(table);

                // zusammengesetzen Code / objekt ans dokument anhängen
                $("BODY").append(div);
                
            }).fail(function (jqXHR, statusText, error) {
                console.log("Error occured");
                console.log("Response Code: " + jqXHR.status + " - Message: " + jqXHR.responseText);
                alert(jqXHR.responseText);
            });
        });
        
        </script>
    </body>
</html>