<!DOCTYPE html>
<html lang="en">

<head>
	<title>GSSTORE-Resgistrierung</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/registration.css">
	<!--===============================================================================================-->

	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>GSSTORE-Shop</title>
	<link rel="icon" href="/pics/gsstorelogo.png">
	<script src="https://kit.fontawesome.com/2b10e96e92.js" crossorigin="anonymous"></script>
	<script src="js/app.js" type="text/javascript" crossorigin="anonymous"></script>

	<!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

	<!-- jQuery and JS bundle w/ Popper.js -->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

	<!-- Custom styles for this template -->
	<link href="css/shop-homepage.css" rel="stylesheet">
	<script src="js/app.js"></script>
</head>

<head>
	<!-- Navigation -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-danger fixed-top">
		<div class="container">
			<a class="navbar-brand" href="index.html"><img src="pics/gsstorelogo.png" size="auto"></a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
				aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarResponsive">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item ">
						<a class="nav-link" href="index.html">HOME
							<span class="sr-only"></span>
						  </a>
						</li>
						<li class="nav-item ">
							<button onclick="app.navigation2.forwardToShop()"><a class="nav-link">SHOP</a></button> 
						</li>
						<li class="nav-item">
						  <a class="nav-link" href="kader.html">KADER</a>
						</li>
						<li class="nav-item">
						  <a class="nav-link" href="ueberuns.html">ÜBER UNS</a>
						</li>
						<li class="nav-item">
						  <a class="nav-link" href="warenkorb.html"><i class="fas fa-shopping-basket" style="font-size: 20px;"></i></a>
						</li>
						<li class="nav-item">
							<button>  <a class="nav-link" onclick="app.navigation.forwardToLoginOrProfile()"><i class="fas fa-user" style="font-size: 20px;"></i></a></button>
						<a class="nav-link" href="index.html">HOME<span class="sr-only"></span></a>
					</li>
					<li class="nav-item ">
						<a class="nav-link" href="shop.html">SHOP</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="kader.html">KADER</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="ueberuns.html">ÜBER UNS</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="warenkorb.html"><i class="fas fa-shopping-basket" style="font-size: 20px;"></i></a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" onclick="app.navigation.forwardToLoginOrProfile()"><i class="fas fa-user" style="font-size: 20px;"></i></a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
</head>

<body>
	<br>
 <h2 style="text-align: center;">Registrieren Sie sich um unseren Shop nutzen zu können!</h2>

	<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100 p-l-55 p-r-55 p-t-65 p-b-50">
				<form action= "/auth/register" class="login100-form validate-form" method="POST">
					<span class="login100-form-title p-b-33"; style="padding: 15px"></span>
						<h2 style="text-align: center;"> Registrierung</h2>
					<br><br>


					<div class="wrap-input100 validate-input" id="vorname">
						<label for="vorname"> Vorname: </label>
						<input class="input100" type="text" name="vorname"  id="vorname" required >
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
					</div>


					<div class="wrap-input100 validate-input" id="nachname">
						<label for="nachname">Nachname: </label>
						<input class="input100" type="text" name="nachname"  id="nachname" required>
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
					</div>

					<br><br>


					<div class="wrap-input100 validate-input" data-validate="Valid email is required: ex@abc.xyz" required id="email">
						<label for="email">Email: </label>
						<input class="input100" type="email" name="email" id="email" required>
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
					</div>
					
					
					<div class="wrap-input100 rs1 validate-input" data-validate="Password is required" required id="password">
						<label for="password">Passwort:</label>
						<input class="input100" type="password" name="password" id="password">
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
					</div>
					
					
					<div class="wrap-input100 rs1 validate-input" data-validate="Password is required" required id="passwordConfirm">
						<label for="passwordConfirm">Passwort wiederholen: </label>
						<input class="input100" type="password" name="passwordConfirm" id="passwordConfirm">
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
					</div>


					<div class="wrap-input100 validate-input" id="street">
						<label for="street">Straße:</label>
						<input class="input100" type="text" name="street" id="street"  required >
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
					</div>

					<div class="wrap-input100 validate-input" id="housenumber">
						<label for="housenumber">Hausnummer: </label>
						<input class="input100" type="text" name="housenumber" id="housenumber" required >
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
					</div>



					<div class="wrap-input100 validate-input" id="postcode">
						<label for="postcode">Postleitzahl: </label>
						<input class="input100" type="text" name="postcode" id="postcode" required>
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
					</div>



					<div class="wrap-input100 validate-input" id="city">
						<label for="city">Ort: </label>
						<input class="input100" type="text" name="city" id="city" required >
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
						

					</div>
					<br><br>
					
					<select name="paymentOption" class="wrap-input100 validate-input" required id="paymentOption" name="paymentOption" style="padding: 4%;">
						<option value="" disabled>Zahlungsart</option>
						<option value="paypal">PayPal</option>
						<option value="sofort">Sofort Überweisung</option>
						<option value="visa">Visa</option>
					  </select>
					
					  
					  <br>

					<div class="container-login100-form-btn m-t-20 bg-danger">
						<button type="button" class="login100-form-btn" onclick="executeRegister()">
							Registrieren
						</button>
					</div>
					<div class="text-center"; style="padding: 5px">
						<span class="txt1">
							Du bist bereits registriert? 
						</span>

						<a href="login.html" class="txt2 hov1">
							Hier anmelden
						</a>
						
					</div>

				</form>
			</div>
		</div>
	</div>

	<script>

		function clearValidationError() {
			$("#vorname").removeClass('invalid-input');
			$("#nachname").removeClass('invalid-input');
			$("#email").removeClass('invalid-input');
			$("#password").removeClass('invalid-input');
			$("#street").removeClass('invalid-input');
			$("#housenumber").removeClass('invalid-input');
			$("#postcode").removeClass('invalid-input');
			$("#city").removeClass('invalid-input');
			$("#paymentOption").removeClass('invalid-input');
		}

		async function executeRegister() {
			const vorname = $("#vorname :input").val();
			const nachname = $("#nachname :input").val();
			const email = $("#email :input").val();
			const password = $("#password :input").val();
			const passwordConfirm = $("#passwordConfirm :input").val();
			const street = $("#street :input").val();
			const housenumber = $("#housenumber :input").val();
			const postcode = $("#postcode :input").val();
			const city = $("#city :input").val();
			const paymentOption = $("#paymentOption").val();
			const data = {vorname, nachname, email, password, street, housenumber, postcode, city, paymentOption};
			console.log('data: ', data);
			const response = await fetch('http://localhost:7000/register', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json;charset=utf-8'
				},
				body: JSON.stringify(data),
			});
			console.log('status: ', response.status);
			const text = await response.text();
			clearValidationError();
			console.log('text: ', text);
			if (response.status === 400) {	// BAD REQUEST
				const payload = JSON.parse(text);
				const required = payload.daten;
				console.log('fehlercode: ', payload.nachricht);
				console.log('required: ', required);
				required.forEach(field => {
					const element = $("#" + field);
					if (!element.hasClass('invalid-input')) {
						element.addClass("invalid-input");
					}
				});
				window.alert('Die Daten sind nicht vollständig angegeben.');
				return;
			} else if (response.status === 409) {	// CONFLICT
				const payload = JSON.parse(text);
				if (payload.nachricht === 'EMAIL_ALREADY_IN_USED') {
					window.alert('Die angegebene Email Adresse wird bereits verwendet.');
					return;
				} else if (payload.nachricht === 'CHECK_EMAIL_FAILED') {
					window.alert('Ein Fehler ist aufgetreten.\nDie Email konnte nicht überprüft werden.');
					return;
				} else if (payload.nachricht === 'CREATE_ADRESS_FAILED') {
					window.alert('Ein Fehler ist aufgetreten.\nDie Kontaktadresse konnte nicht erstellt werden.');
					return;
				} else if (payload.nachricht === 'CREATE_PERSON_FAILED') {
					window.alert('Ein Fehler ist aufgetreten.\nDer Kontakt konnte nicht erstellt werden.');
					return;
				} else if (payload.nachricht === 'CREATE_PERSON_FAILED') {
					window.alert('Ein Fehler ist aufgetreten.\nDer Kontakt konnte nicht erstellt werden.');
					return;
				}			

				return;
			} else if (response.ok) {
				window.location.replace("login.html");
			}

			
		}
	</script>

	<!-- Footer -->
	<footer class="footer py-4 bg-danger">
		<div class="container">
			<a href="kontakt.html" style="text-align: left;"  class="footer_element"><b> Kontakt</b></a>
			<a href="agb.html" style="text-align: center;" class="footer_element"> <b>AGB</b></a>
			<a href="impressum.html" style="text-align: right;" class="footer_element"> <b>Impressum</b></a>
		</div>


	</footer>




</body>

</html>