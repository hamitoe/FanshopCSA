<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>GSSTORE-Shop</title>
  <link rel="icon" href="pics/gsstorelogo.png">
  <script src="https://kit.fontawesome.com/2b10e96e92.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link href="css/shop-homepage.css" rel="stylesheet">

  <!-- security check -->
  
  <script src="js/sessionHandling.js"></script>
  <script src="js/urlParameter.js"></script>
  <script src="js/formatPrice.js"></script>

</head>

<header>
  <!-- Navigation -->

  <nav class="navbar navbar-expand-lg navbar-dark bg-danger fixed-top">
    <div class="container">
      <a class="navbar-brand" href="index.html"><img src="pics/gsstorelogo.png" size="auto"></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
        aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item ">
            <a class="nav-link " href="index.html">HOME
              <span class="sr-only"></span>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="shop.html">SHOP</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="kader.html">KADER</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="ueberuns.html">ÜBER UNS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="warenkorb.html"><i class="fas fa-shopping-basket"
                style="font-size: 20px;"></i></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="login.html"><i class="fas fa-user" style="font-size: 20px;"></i></a>
          </li>
        </ul>
      </div>
    </div>
  </nav>


</header>

<body>


  <div class="container">
    <h1 class="jumbotron-heading" style="text-align: center;">Warenkorb</h1>
  </div>


  <div class="container mb-4">
    <div class="row">
      <div class="col-12">
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col"> </th>
                <th scope="col">Produkt</th>
                <th scope="col">Größe</th>
                <th scope="col" class="text-center">Anzahl</th>
                <th scope="col" class="text-right">Preis</th>
                <th> </th>
              </tr>
            </thead>
            <tbody id="renderShoppingCart">
              


              <tr>
                <td></td>
                <td></td>
                <td></td>

                <td>Summe</td>
                <td class="text-right">78,81€</td>
                <td></td>
              </tr>
              <tr>
                <td></td>
                <td></td>
                <td></td>
                <td>16% MwSt</td>
                <td class="text-right">15,02€</td>
                <td></td>
              </tr>
              <tr>
                <td></td>
                <td></td>
                <td></td>

                <td><strong>Summe inkl. 16%MwSt</strong></td>
                <td class="text-right"><strong>93,83€</strong></td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <br>
      <div class="return_infos">
        <div class="card border-dark mb-3" style="max-width: 18rem;">
          <div class="card-header"><b>Informationen zu Retoure</b></div>
          <div class="card-body text-dark">
            <p class="card-text">
              Verpacke das Produkt in der ursprünglichen Verpackung und schicke es innerhalb von 30 Tagen zurück. Lege
              diesen
              Abschnitt des Lieferscheins bei. Wir bemühen uns, dir den ursprünglichen Kaufpreis innerhalb von zwei
              vollen Werktagen nach Ankunft der Sendung zu erstatten.</p>
          </div>
        </div>

      </div>
      <div class="payment_options">
        <div class="card border-dark mb-3" style="max-width: 18rem;">
          <div class="card-header"><b>Bitte Bezahloption wählen</b></div>
          <div class="card-body text-dark">
            <p class="card-text"> <input type="radio" id="male" name="paymentoption" value="paypal">
              <label for="male"><i class="fab fa-cc-visa" style="font-size: 50px;"></i></label><br>
              <input type="radio" id="female" name="paymentoption" value="visa">
              <label for="female"><i class="fab fa-paypal" style="font-size: 50px;"></i></label><br>
              <input type="radio" id="other" name="paymentoption" value="sofortueb" checked>
              <label for="other"><b>Sofort Überweisung</b></label>
            </p>
          </div>
        </div>





      </div>


      <div class="col mb-2">
        <div class="row">
          <div class="col-sm-12  col-md-6">
            <a href="shop.html"><button class="btn btn-lg btn-block btn-success text-uppercase btn-light"><b>WEITER
                  EINKAUFEN</b></button></a>
          </div>
          <div class="col-sm-12 col-md-6 text-right">
            <a href="Bestellbestätigung.html"><button
                class="btn btn-lg btn-block btn-success text-uppercase btn-danger"><b>Jetzt bezahlen</b></button></a>

          </div>


        </div>
        <br>
        <br>
        <form class="was-validated">
          <div class="custom-control custom-checkbox mb-3">
            <input type="checkbox" class="custom-control-input" id="customControlValidation1" required>
            <label class="custom-control-label" for="customControlValidation1">Es gelten unsere <a
                href="agb.html">Allgemeinen Geschäftsbedingungen</a>.</label>
            <div class="invalid-feedback">Bitte bestätigen Sie die AGB !</div>
          </div>
        </form>

      </div>

    </div>

  </div>
  <script>
    
    var basket = [];

    $('document').ready(async function(){

      if(existsSessionItem('basket')){
        basket = getJSONSessionItem('basket');
      }

      if(existsUrlParameter('addToBasket')){
      
        var productid = getUrlParameterValue('addToBasket');
        console.log("ProduktID: " + productid)
        ziel = "http://localhost:7000/shop/gib/" + productid;

        const response = await fetch(ziel, {
          method: 'GET'
        });

        try {
          if (response.status == 200 || response.status == 201) {
            loadedProduct = await response.json();
            console.log(loadedProduct);
            

          }
        } catch (error) {
          console.log(error);


      }
    }

    var idx = -1;
    for (i = 0; i < basket.length; i++){
      if (basket[i].productid == productid){
        idx = i;
        break;
      }
    }

    if (idx == -1){
        var orderPosition = {
        product: loadedProduct,
        amount: 1,
        sum: 0.0
        };
      orderPosition.sum = orderPosition.product.preis * orderPosition.amount;

      basket.push(orderPosition);

    }else {
      basket[idx].amount++;
      basket[idx].sum = basket[idx].product.preis * basket[idx].amount;


    }

    setJSONSessionItem('basket', basket);
    
    showBasket();

    });

    function showBasket(){
      console.log(basket);

      if (basket.length == 0){
        $('#renderShoppingCart').html("Der Warenkorb ist leer");
      }else {
        
      
     document.getElementById("renderShoppingCart").innerHTML =
         ` 
     ${basket.map(function (basketItem) {
       console.log(basketItem);
             return `
      

             <tr>
             <td><img class="shopping-cart-pic-size" src="${basketItem.product.BildPfad}"  /> </td>
             <td>${basketItem.product.Beschreibung}</td>
             <td>M</td>
             <td><input class="form-control" type="text" value="1" /></td>
             <td class="text-right">${toEuro(basketItem.product.Preis)}</td>
             <td class="text-right"><button class="btn btn-sm btn-danger"><i class="fa fa-trash"></i> </button> </td>
             </tr>
  
            
         `
         }).join("")}
    
     `
      }

    }


    function removeItemFromBasket() {
      

      
    }
    

    

  </script>



  <footer class="footer py-4 bg-danger">
    <div class="container">
      <a href="kontakt.html" style="text-align: left;" class="footer_element"><b> Kontakt</b></a>
      <a href="agb.html" style="text-align: center;" class="footer_element"> <b>AGB</b></a>
      <a href="impressum.html" style="text-align: right;" class="footer_element"> <b>Impressum</b></a>
    </div>


  </footer>

</body>


</html>