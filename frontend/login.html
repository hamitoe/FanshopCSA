<!DOCTYPE html>
<html lang="en">

<head>
	<title>GSSTORE-Anmeldung</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<link rel="stylesheet" type="text/css" href="css/shop-homepage.css">
	<!--===============================================================================================-->

	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>GSSTORE-Login</title>
	<link rel="icon" href="pics/gsstorelogo.png">
	<script src="https://kit.fontawesome.com/2b10e96e92.js" crossorigin="anonymous"></script>
	<script src="js/app.js" type="text/javascript" crossorigin="anonymous"></script>

	<!-- Bootstrap core CSS -->
	<!-- CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
		integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

	<!-- jQuery and JS bundle w/ Popper.js -->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
		integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
		crossorigin="anonymous"></script>

	<!-- Custom styles for this template -->
	<link href="css/shop-homepage.css" rel="stylesheet">

</head>
<header>
	<!-- Navigation -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-danger fixed-top">
		<div class="container">
			<a class="navbar-brand" href="index.html"><img src="pics/gsstorelogo.png" size="auto"></a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
				aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarResponsive">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item ">
						<a class="nav-link " href="index.html">HOME
							<span class="sr-only"></span>
						</a>
					</li>
					<li class="nav-item ">
						<button onclick="app.navigation2.forwardToShop()"><a class="nav-link">SHOP</a></button>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="kader.html">KADER</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="ueberuns.html">ÜBER UNS</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="warenkorb.html"><i class="fas fa-shopping-basket"
								style="font-size: 20px;"></i></a>
					</li>
					<li class="nav-item">
						<button> <a class="nav-link" onclick="app.navigation.forwardToLoginOrProfile()"><i
									class="fas fa-user" style="font-size: 20px;"></i></a></button>

					</li>
				</ul>
			</div>
		</div>
	</nav>
</header>

<body>



	<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100 p-l-55 p-r-55 p-t-65 p-b-50">
				<form id="loginForm" name="loginForm" class="login100-form validate-form">
					<span class="login100-form-title p-b-33" ; style="padding: 15px">
						ANMELDUNG
					</span>

					<div class="wrap-input100 validate-input" data-validate="Valid email is required: ex@abc.xyz">
						<label for="email">Bitte Email Adresse eingeben:</label>
						<input class="input100" type="text" name="email" id="email" required>
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
					</div>

					<div class="wrap-input100 rs1 validate-input" data-validate="Password is required">
						<label for="password">Bitte Passwort eingeben: </label>
						<input class="input100" type="password" name="password" id="password">
						<span class="focus-input100-1"></span>
						<span class="focus-input100-2"></span>
					</div>

					<div class="container-login100-form-btn m-t-20 bg-danger">
						<input type="button" class="login100-form-btn bg-danger" value="anmelden"
							onclick="executeLogin()"></button>
					</div>

					<div class="text-center" ; style="padding: 5px">
						<span class="txt1">
							Noch keinen Account bei uns?
						</span>

						<a href="register.html" class="txt2 hov1">
							Jetzt registrieren
						</a>



					</div>

				</form>

			</div>
		</div>
	</div>
	<script>
		async function executeLogin() {
			const email = $("#email").val();
			const password = $("#password").val();
			if (email === '') {
				window.alert('Keine Email angegeben.');
				return;
			}
			if (password === '') {
				window.alert('Kein Passwort angegeben.');
				return;
			}

			const data = { email: email, password: password };
			const response = await fetch('http://localhost:7000/login', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json;charset=utf-8',
				},
				credentials: 'include',
				body: JSON.stringify(data),
			});
			console.log('status: ', response.status);
			if (response.ok) {
				window.location.replace("shop.html");
			}
			else if (response.status === 400) {
				// Eingabe unvollständig.
				let text = await response.text();
				const payload = JSON.parse(text);
				if (payload.nachricht === 'NO_EMAIL') {
					window.alert('Keine Email angegeben.');
				} else if (payload.nachricht === 'NO_PASSWORD') {
					window.alert('Kein Passwort angegeben.');
				}
			} else if (response.status === 401) {
				// Falsche Email bzw. falsches Passwort angegeben.
				let text = await response.text();
				const payload = JSON.parse(text);
				if (payload.nachricht === 'EMAIL_INVALID') {
					window.alert('Die Email existiert nicht.');
				} else if (payload.nachricht === 'PASSWORD_INVALID') {
					window.alert('Die Passwort ist nicht korrekt.');
				}
			}

		}

	</script>
	<!-- Footer -->
	<footer class="footer py-4 bg-danger">
		<div class="container">
			<a href="kontakt.html" style="text-align: left;" class="footer_element"><b> Kontakt</b></a>
			<a href="agb.html" style="text-align: center;" class="footer_element"> <b>AGB</b></a>
			<a href="impressum.html" style="text-align: right;" class="footer_element"> <b>Impressum</b></a>
		</div>


	</footer>

</body>
</html>